<div id="page-wrapper">
  <div class="col-md-8">
    <div class="highlight-box">
      <h4 class="page-title m-b-md">Set rates for <%= @vehicle_type.name%></h4>
      <div class=" medium-bottom-margin number-edit-box">
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">
          Distance Estimate Settings for <%= @vehicle_type.name%>
        </div>
        <div class="panel-body">
          <div id="distance">
            <div class="">
              <div class="">
                <div class="m-t-md" id="base_transfer_distance">
                  <strong>Base Transfer Distance:</strong> <span class="best_in_place"><%= @vehicle_type.base_transfer_distance ? @vehicle_type.base_transfer_distance : '0.0'%></span> mile(s)
                  <a href="/vehicle_types/get_base_transfer_distance" data-remote="true">edit</a>
                </div>
                <%if @vehicle_type.distance_estimation_settings.size > 0%>
                  <table class="table table-condensed table-striped small m-t-lg">
                    <thead>
                      <tr>
                        <th>Rate group</th>
                        <th>Up to (miles)</th>
                        <th>Base charge</th>
                        <th>Cost per <br> distance unit</th>
                        <th>Miles <br> per distance unit</th>
                        <th></th>
                      </tr>
                    </thead>
                    <tbody>
                      <%@vehicle_type.distance_estimation_settings.each do |setting|%>
                        <tr>
                          <td><%= setting.rate_group %></td>
                          <td><%= setting.up_to_mile %></td>
                          <td><%= setting.base_charge %></td>
                          <td><%= setting.cost_per_distance %></td>
                          <td><%= setting.miles_per_distance %></td>
                          <td>
                            <a data-toggle="modal" href="#distance_estimate_modal" class="btn btn-xs btn-primary"><i class="icon-edit"></i> Edit</a>
                            <a class="btn btn-xs btn-danger"><i class="icon-trash"></i> Delete</a>
                          </td>
                        </tr>
                      <%end%>
                    </tbody>
                  </table>
                <%end%>
                <a href="#distance_estimate_modal" data-toggle="modal" class="btn btn-primary btn-mini"><i class="icon-plus"></i> New Distance Estimate Setting</a>

              </div> <!-- /widget-content -->
            </div>
            <div id="distance_estimate_modal" class="modal">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <button data-dismiss="modal" class="close">×</button>
                    <h3>Distance Estimate Settings</h3>
                  </div>
                  <form class="form form-horizontal" id="form">
                    <div class="modal-body">

                      <div class="form-group">
                        <label for="type" class="control-label col-sm-3">Rate group</label>
                        <div class="controls col-sm-8">
                          <select class="form-control"><option>Regular</option></select>
                        </div>
                      </div>


                      <div class="form-group">
                        <label for="max_volume" class="control-label col-sm-3">Up to (miles)</label>
                        <div class="controls col-sm-8">
                          <input type="text" value="" id="up_to_mile" class="form-control">
                        </div>
                      </div>

                      <div class="form-group">
                        <label for="max_volume" class="control-label col-sm-3">Base charge</label>
                        <div class="controls col-sm-8">
                          <input type="text" value="" id="base_charge" class="form-control">
                        </div>
                      </div>

                      <div class="form-group">
                        <label for="cost_per_unit" class="control-label col-sm-3">Cost Per Distance Unit</label>
                        <div class="controls col-sm-8">
                          <input type="text" value="" id="cost_per_distance" class="form-control">
                        </div>
                      </div>
                      <div class="form-group">
                        <label for="cost_per_mile" class="control-label col-sm-3">Miles Per Distance Unit</label>
                        <div class="controls col-sm-8">
                          <input type="text" value="" id="miles_per_distance" data-bind="value: distance_unit" class="form-control">
                        </div>
                      </div>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-primary" onclick="add_distance_estimation_settings();">Add Distance Estimate</button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>









      <div class="panel panel-default">
        <div class="panel-heading">
          Hourly Estimate Settings for Sedan
        </div>
        <div class="panel-body">
          <div id="hourly">


            <div class="">

              <div class="medium-top-margin">
                <strong>Hourly minimum:</strong> <span data-type="input" data-activator="#minimum_hours_edit_button" data-attribute="minimum_hours" data-object="vehicle_type" data-url="/vehicle_types/1957" id="best_in_place_vehicle_type_1957_minimum_hours" class="best_in_place">3.0</span> hour(s)
                <a class="" id="minimum_hours_edit_button" href="#">edit</a>
              </div>

              <table class="table table-condensed table-striped small m-t-md">
                <thead>
                  <tr>
                    <th>Rate group</th>
                    <th>Service</th>
                    <th>Up to (hours)</th>
                    <th>Hourly Rate</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody data-bind="template: {name: &quot;hesIndexTemplate&quot;, foreach: items}">
                  <tr>
                    <!-- /// 3 -->
                    <td data-bind="text: rate_group_name">Regular</td>
                    <td data-bind="text: service_name">All</td>
                    <td data-bind="text: max_hours+' hour(s)'">24.0 hour(s)</td>
                    <td data-bind="text: '$'+cost_per_hour">$45.0</td>
                    <td>

                      <a data-toggle="modal" href="#hourly_estimate_modal" data-bind="click: function() { hesViewModel.editAction($data) }" class="btn btn-xs btn-primary"><i class="icon-edit"></i> Edit</a>
                      <a data-bind="click: function() { hesViewModel.destroyAction($data) }" class="btn btn-xs btn-danger"><i class="icon-trash"></i> Delete</a>


                    </td></tr>
                </tbody>

              </table>
              <a data-bind="click: function() { hesViewModel.newAction() }" href="#hourly_estimate_modal" data-toggle="modal" class="btn btn-primary btn-mini"><i class="icon-plus"></i> New Hourly Estimate Setting</a>

            </div> <!-- /widget-content -->


            <div id="hourly_estimate_modal" class="modal">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <button data-dismiss="modal" class="close">×</button>
                    <h3>Hourly Estimate Setting</h3>
                  </div>
                  <div data-bind="visible: currentPage() == &quot;new&quot;" style="display: none;">
                    <div data-bind="template: {name: &quot;hesNewTemplate&quot;, data: tempItem}">
                      <form class="form form-horizontal" id="form_hes_new">
                        <div class="modal-body">
                          <input type="hidden" value="1957" name="hourly_estimate_setting[vehicle_type_id]" id="hourly_estimate_setting_vehicle_type_id" data-bind="value: vehicle_type_id">


                          <div class="form-group">
                            <label for="type" class="control-label col-sm-3">Rate group</label>
                            <div class="controls col-sm-8">
                              <select data-bind="options: rateGroups, optionsText: 'name',  optionsValue: 'id', value: rate_group_id" class="form-control"><option value="737">Regular</option></select>
                            </div>
                          </div>

                          <div class="form-group">
                            <label for="type" class="control-label col-sm-3">Service</label>
                            <div class="controls col-sm-8">
                              <select data-bind="options: services, optionsText: 'name', optionsCaption: 'All services', optionsValue: 'id', value: service_id" class="form-control"><option value="">All services</option><option value="3272">Hourly Charter</option></select>
                            </div>
                          </div>


                          <div class="form-group">
                            <label for="max_volume" class="control-label col-sm-3">Up to (hours)</label>
                            <div class="controls col-sm-8">
                              <input type="text" value="" name="hourly_estimate_setting[max_hours]" id="hourly_estimate_setting_max_hours" data-bind="value: max_hours" class="form-control">
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="max_weight" class="control-label col-sm-3">Hourly Rate</label>
                            <div class="controls col-sm-8">
                              <input type="text" value="" name="hourly_estimate_setting[cost_per_hour]" id="hourly_estimate_setting_cost_per_hour" data-bind="value: cost_per_hour" class="form-control">
                            </div>
                          </div>



                        </div>
                        <div class="modal-footer">
                          <button class="btn btn-primary" data-bind="click: function() { hesViewModel.createAction($data) }">Add Hourly Estimate Setting</button>
                        </div>
                      </form>
                    </div>
                  </div>
                  <div data-bind="visible: currentPage() == &quot;edit&quot;" style="display: none;">
                    <div data-bind="template: {name: &quot;hesEditTemplate&quot;, data: tempItem, templateOptions: { selectedItem: selectedItem}}">
                      <form class="form form-horizontal" id="form_hes_edit">
                        <div class="modal-body">
                          <input type="hidden" value="1957" name="hourly_estimate_setting[vehicle_type_id]" id="hourly_estimate_setting_vehicle_type_id" data-bind="value: vehicle_type_id">

                          <div class="form-group">
                            <label for="type" class="control-label col-sm-3">Rate group</label>
                            <div class="controls col-sm-8">
                              <select data-bind="options: rateGroups, optionsText: 'name',  optionsValue: 'id', value: rate_group_id" class="form-control"><option value="737">Regular</option></select>
                            </div>
                          </div>

                          <div class="form-group">
                            <label for="type" class="control-label col-sm-3">Service</label>
                            <div class="controls col-sm-8">
                              <select data-bind="options: services, optionsText: 'name', optionsCaption: 'All services', optionsValue: 'id', value: service_id" class="form-control"><option value="">All services</option><option value="3272">Hourly Charter</option></select>
                            </div>
                          </div>


                          <div class="form-group">
                            <label for="max_volume" class="control-label col-sm-3">Up to (hours)</label>
                            <div class="controls col-sm-8">
                              <input type="text" value="" name="hourly_estimate_setting[max_hours]" id="hourly_estimate_setting_max_hours" data-bind="value: max_hours" class="form-control">
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="max_weight" class="control-label col-sm-3">Hourly Rate</label>
                            <div class="controls col-sm-8">
                              <input type="text" value="" name="hourly_estimate_setting[cost_per_hour]" id="hourly_estimate_setting_cost_per_hour" data-bind="value: cost_per_hour" class="form-control">
                            </div>
                          </div>


                        </div>
                        <div class="modal-footer">
                          <button class="btn btn-primary" data-bind="click: function() { hesViewModel.updateAction($data) }">Update Hourly Estimate Setting</button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
  var id = <%= @vehicle_type.id %>
  /////////////////////////////////////////////////////////// 
  function update_base_transfer_distance()
  {
    var base_transfer_distance = $('#base_transfer_distance_input').val();
    $.ajax({
      url: '/vehicle_types/update_base_transfer_distance',
      type: "POST",
      data: {
        id: id,
        base_transfer_distance: base_transfer_distance
      }
    });
  }
//////////////////////////////////////////////////////////
  function add_distance_estimation_settings()
  {
    $('#distance_estimate_modal').modal('hide');
    var rate_group = "Regular";
    var up_to_mile = $('#up_to_mile').val();
    var base_charge = $('#base_charge').val();
    var cost_per_distance = $('#cost_per_distance').val();
    var miles_per_distance = $('#miles_per_distance').val();
    $.ajax({
      url: '/vehicle_types/add_distance_estimation_settings',
      type: "POST",
      data: {
        id: id,
        rate_group: rate_group,
        up_to_mile: up_to_mile,
        base_charge: base_charge,
        cost_per_distance: cost_per_distance,
        miles_per_distance: miles_per_distance
      }
    });
  }

</script>